### 领域驱动设计（Domain Driven Design）

#### 软件设计原则

​	**开闭原则是总纲，它告诉我们要对扩展开放，对修改关闭；里氏替换原则告诉我们不要破坏继承体系；依赖倒置原则告诉我们要面向接口编程；单一职责原则告诉我们实现类要职责单一；接口隔离原则告诉我们在设计接口的时候要精简单一；迪米特法则告诉我们要降低耦合度；合成复用原则告诉我们要优先使用组合或者聚合关系复用，少用继承关系复用。**

- **单一职责原则（Single Responsibility Principle）：**单一性原则要求一个对象/类应该只有一个变更的原因。但是在这个案例里，代码可能会因为任意一个外部依赖或计算逻辑的改变而改变。
- **依赖反转原则（Dependency Inversion Principle）：**依赖反转原则要求在代码中依赖抽象，而不是具体的实现。在这个案例里外部依赖都是具体的实现，比如YahooForexService虽然是一个接口类，但是它对应的是依赖了Yahoo提供的具体服务，所以也算是依赖了实现。同样的KafkaTemplate、MyBatis的DAO实现都属于具体实现。
- **开放封闭原则（Open Closed Principle）：**开放封闭原则指开放扩展，但是封闭修改。在这个案例里的金额计算属于可能会被修改的代码，这个时候该逻辑应该需要被包装成为不可修改的计算类，新功能通过计算类的拓展实现。
- **里氏替换原则**
- **接口隔离原则**
-  **迪米特法则**
- **合成复用原则**

https://www.cnblogs.com/cainiao-chuanqi/p/10959800.html

#### DDD如何解决软件复杂性

​	DDD解决软件复杂性的方法核心为两点：

- 通过领域模型为业务知识建模，领域模型作为业务、技术团队沟通的统一语言。
- 确保软件实现与领域模型保持一致。

软件实现与领域模型保持一致是本书的核心思想，DDD构建了一套完整的方法论来支持领域模型驱动程序设计。这套方法论简述如下。

- 分层架构：业务规则的代码只占软件很少的代码却是最核心的部分代码，将其分离出来作为独立的领域层，使领域层的实现与领域模型保持一致，领域层的业务对象不再是贫血模型。
- 领域驱动设计：领域驱动设计，即领域模型驱动程序设计。这里给出了如何通过代码表达领域模型的编码模式。这些模式包括：关联、实体、值对象、服务、聚合根、Repository、Factory。它们构建了将领域模型表达成代码的方法论，保证了代码和设计一致。
- 战略设计：复杂领域模型的实现方法论。

https://www.cnblogs.com/baihmpgy/p/10760324.html

#### 分层架构

​	DDD分层架构一个核心任务，就是将软件最重要的资产——业务规则分离出来，抽象在领域层，确保这些代码是领域模型的正确实现。

DDD把模型分为四层：

1. UI层，负责页面展示
2. 应用层（Application Layer），负责业务流程，领域对象协调工作。
3. 领域层（Domain Layer），负责领域逻辑，表达业务概念，业务规则。
4. 基础设施层（Infrastructure Layer），负责提供基建。可以给应用层提供消息，为领域层提供持久化。

案例：

#### 领域模型

​	我们可以使用UML建模，使用最简单、最容易理解的名词-形容词-动词法对领域知识进行建模，使用该模型作为与业务、技术团队沟通的通用语言。

在名词-形容词-动词法建模方法中，领域知识中的名词一般对应模型、形容词对应模型属性、动词对应模型方法。模型之间的关系有：组合、聚合、关联、依赖，四者关系由强到弱。

依赖(Dependency)关系是类与类之间的联接。依赖关系表示一个类依赖于另一个类的定义。一般而言，依赖关系在Java语言中体现为局域变量、方法的形参，或者对静态方法的调用。 

关联(Association）关系是类与类之间的联接，它使一个类知道另一个类的属性和方法。关联可以是双向的，也可以是单向的。在Java语言中，关联关系一般使用成员变量来实现。 

聚合(Aggregation) 关系是关联关系的一种，是强的关联关系。聚合是整体和个体之间的关系。例如，汽车类与引擎类、轮胎类，以及其它的零件类之间的关系便整体和个体的关系。与关联关系一样，聚合关系也是通过实例变量实现的。但是关联关系所涉及的两个类是处在同一层次上的，而在聚合关系中，两个类是处在不平等层次上的，一个代表整体，另一个代表部分。 

组合(Composition) 关系是关联关系的一种，是比聚合关系强的关系。它要求普通的聚合关系中代表整体的对象负责代表部分对象的生命周期，组合关系是不能共享的。代表整体的对象需要负责保持部分对象和存活，在一些情况下将负责代表部分的对象湮灭掉。代表整体的对象可以将代表部分的对象传递给另一个对象，由后者负责此对象的生命周期。换言之，代表部分的对象在每一个时刻只能与一个对象发生组合关系，由后者排他地负责生命周期。部分和整体的生命周期一样。 

简而言之，组合关系表示部分与整体关系，部分不能单独存在；聚合关系表示稍弱的部分与整体关系，部分可以单独存在；关联关系是一个模型和另一个模型的联接，比如一个订单有一个顾客而一个顾客有多个订单；依赖是最弱的关系，表示一个模型的实现使用到另一个模型的功能。

https://www.jianshu.com/p/57620b762160

​	领域驱动设计，即领域模型驱动程序设计，它的核心是保证系统的实现与实际的业务规则一致，完整实现了领域模型。它包含了两个部分：领域模型、领域模型的编程实现。

在软件设计和实现过程中要充分利用领域模型，设计过程中，领域模型作为与业务专家的沟通语言；实现过程中，领域模型作为与开发人员沟通的语言。领域模型在软件生命周期过程作为通用语言。

领域模型的实现代码在领域层，它完整实现了领域模型的内部结构和模型之间的关系。领域模型的实现代码由以下几个部分构成：

- 领域模型关系的实现：组合、聚合、关联、依赖。
- 领域模型的实现：实体和值对象。
- 跨领域模型的业务规则的实现：领域服务。

##### 领域模型关系的实现

​	聚合、组合、关联关系在实现上的表现基本上是一个类（或者类的标识）作为另一个类的属性；而依赖关系则是一个类作为另一个类在方法的实现上的参数、变量，为另一个类提供功能实现。

##### 领域模型的实现

​	领域模型在实现上表现为两类：（1）实体（Entity）：这个领域模型有特定的标识，但是其内部状态会随着一序列的事件（对应业务规则的执行）发生变化，我们把这类模型的实现称为实体；（2）值对象（Value Object）：这个领域模型由属性来定义，实例创建后不会发生变更，变更也意味着重新创建一个实例，我们把这类模型的实现称为值对象。





#### 实战：文件管理系统

##### 返回值和异常处理规范，Result vs Exception

规范：Interface层的HTTP和RPC接口，返回值为Result，捕捉所有异常

规范：Application层的所有接口返回值为DTO（封装类），不负责处理异常



领域层、应用层、基础层，每层都有自己的model类，各层需要有对应的转换类的工厂类。每层都有自己的service接口，领域层专门处理领域对象的逻辑，应用层来处理use case（领域对象的集合业务）。

https://blog.csdn.net/abchywabc/article/details/79362975







https://developer.aliyun.com/article/783664?spm=a2c6h.14164896.0.0.15847879QeFgLN

https://developer.aliyun.com/article/716908?spm=a2c6h.13262185.0.0.52db67f9u93X3M

https://developer.aliyun.com/article/719251



https://ithelp.ithome.com.tw/users/20111997/ironman/2730